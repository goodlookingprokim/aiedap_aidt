<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ í”¼ë“œë°± ë³´ë“œ - HTHTÃ—SEL í”„ë¡œì íŠ¸</title>
    <meta name="description" content="ëª¨ë‘ ë³„ í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì‹¤ì‹œê°„ í”¼ë“œë°±ì„ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆëŠ” í˜‘ë ¥ ë„êµ¬">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    
    <style>
        .main-content {
            padding: var(--spacing-xl) 0;
            min-height: calc(100vh - 200px);
        }

        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto var(--spacing-lg);
            line-height: 1.6;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .control-row {
            display: flex;
            gap: var(--spacing-lg);
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: var(--spacing-lg);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .control-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .control-input {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            min-width: 150px;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .room-info {
            background: var(--bg-gradient-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-left: auto;
        }

        .room-code {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        /* í”¼ë“œë°± ì…ë ¥ ì˜ì—­ */
        .feedback-input-section {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .feedback-form {
            display: grid;
            gap: var(--spacing-lg);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-select, .form-textarea {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .feedback-type-selector {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .feedback-type-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 0.9rem;
        }

        .feedback-type-btn:hover {
            border-color: var(--primary-color);
        }

        .feedback-type-btn.active {
            background: var(--bg-gradient);
            color: var(--text-white);
            border-color: var(--primary-color);
        }

        /* í”¼ë“œë°± ë³´ë“œ */
        .feedback-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .feedback-column {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .column-header {
            padding: var(--spacing-lg);
            background: var(--bg-gradient);
            color: var(--text-white);
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .column-content {
            padding: var(--spacing-lg);
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .feedback-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition-normal);
            animation: slideIn 0.3s ease-out;
        }

        .feedback-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .feedback-card.positive {
            border-left-color: var(--success-color);
        }

        .feedback-card.constructive {
            border-left-color: var(--warning-color);
        }

        .feedback-card.question {
            border-left-color: var(--info-color);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .feedback-author {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .feedback-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .feedback-type-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .feedback-type-badge.positive {
            background: rgba(72, 187, 120, 0.2);
            color: var(--success-color);
        }

        .feedback-type-badge.constructive {
            background: rgba(237, 137, 54, 0.2);
            color: var(--warning-color);
        }

        .feedback-type-badge.question {
            background: rgba(66, 153, 225, 0.2);
            color: var(--info-color);
        }

        .feedback-content {
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: var(--spacing-sm);
        }

        .feedback-target {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-style: italic;
        }

        .feedback-actions {
            display: flex;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .feedback-action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            font-size: 0.8rem;
        }

        .feedback-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .feedback-action-btn.liked {
            color: var(--primary-color);
        }

        /* í†µê³„ íŒ¨ë„ */
        .stats-panel {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-lg);
        }

        .stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .room-info {
                margin-left: 0;
                justify-content: center;
            }

            .feedback-board {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: var(--spacing-2xl);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ì€ common.jsì—ì„œ ìë™ ìƒì„±ë©ë‹ˆë‹¤ -->

    <main class="main-content">
        <div class="container">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <div class="page-header">
                <h1 class="page-title">ì‹¤ì‹œê°„ í”¼ë“œë°± ë³´ë“œ</h1>
                <p class="page-subtitle">
                    ëª¨ë‘ ë³„ í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì‹¤ì‹œê°„ í”¼ë“œë°±ì„ ì£¼ê³ ë°›ìœ¼ë©° í˜‘ë ¥ì  í•™ìŠµì„ ê²½í—˜í•´ë³´ì„¸ìš”
                </p>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label class="control-label">ì°¸ì—¬ì ì´ë¦„</label>
                        <input type="text" class="control-input" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="control-group">
                        <label class="control-label">ëª¨ë‘ ëª…</label>
                        <input type="text" class="control-input" id="teamName" placeholder="ëª¨ë‘ ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="control-group">
                        <label class="control-label">ì„¸ì…˜ ì½”ë“œ</label>
                        <input type="text" class="control-input" id="sessionCode" placeholder="ì„¸ì…˜ ì½”ë“œ (ì„ íƒì‚¬í•­)">
                    </div>
                    <div class="room-info">
                        <i class="fas fa-users"></i>
                        <span>ë°© ì½”ë“œ: <span class="room-code" id="roomCode">HTHT2024</span></span>
                    </div>
                </div>
            </div>

            <!-- í”¼ë“œë°± ì…ë ¥ ì„¹ì…˜ -->
            <div class="feedback-input-section">
                <h2 style="margin-bottom: var(--spacing-lg); color: var(--text-primary);">
                    <i class="fas fa-comment-dots"></i> í”¼ë“œë°± ì‘ì„±í•˜ê¸°
                </h2>
                
                <form class="feedback-form" id="feedbackForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ëŒ€ìƒ ëª¨ë‘ </label>
                            <select class="form-select" id="targetTeam" required>
                                <option value="">ëª¨ë‘ ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="1ëª¨ë‘ ">1ëª¨ë‘ </option>
                                <option value="2ëª¨ë‘ ">2ëª¨ë‘ </option>
                                <option value="3ëª¨ë‘ ">3ëª¨ë‘ </option>
                                <option value="4ëª¨ë‘ ">4ëª¨ë‘ </option>
                                <option value="5ëª¨ë‘ ">5ëª¨ë‘ </option>
                                <option value="ì „ì²´">ì „ì²´</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">í”¼ë“œë°± ìœ í˜•</label>
                            <div class="feedback-type-selector">
                                <button type="button" class="feedback-type-btn active" data-type="positive">
                                    <i class="fas fa-thumbs-up"></i> ê¸ì •ì 
                                </button>
                                <button type="button" class="feedback-type-btn" data-type="constructive">
                                    <i class="fas fa-lightbulb"></i> ê°œì„  ì œì•ˆ
                                </button>
                                <button type="button" class="feedback-type-btn" data-type="question">
                                    <i class="fas fa-question-circle"></i> ì§ˆë¬¸
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í”¼ë“œë°± ë‚´ìš©</label>
                        <textarea class="form-textarea" id="feedbackContent" 
                                placeholder="êµ¬ì²´ì ì´ê³  ê±´ì„¤ì ì¸ í”¼ë“œë°±ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..." required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">SEL ì—­ëŸ‰ ì—°ê³„</label>
                            <select class="form-select" id="selCompetency">
                                <option value="">ê´€ë ¨ SEL ì—­ëŸ‰ (ì„ íƒì‚¬í•­)</option>
                                <option value="selfAwareness">âœª ìê¸°ì¸ì‹</option>
                                <option value="selfManagement">â™¢ ìê¸°ê´€ë¦¬</option>
                                <option value="socialAwareness">â™§ ì‚¬íšŒì  ì¸ì‹</option>
                                <option value="relationshipSkills">â™¤ ê´€ê³„ ê¸°ìˆ </option>
                                <option value="responsibleDecision">â˜… ì±…ì„ ìˆëŠ” ì˜ì‚¬ê²°ì •</option>
                            </select>
                        </div>
                        <div class="form-group" style="display: flex; align-items: end;">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i>
                                í”¼ë“œë°± ì „ì†¡
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- í†µê³„ íŒ¨ë„ -->
            <div class="stats-panel">
                <h2 style="text-align: center; margin-bottom: var(--spacing-lg); color: var(--text-primary);">
                    ğŸ“Š ì‹¤ì‹œê°„ í†µê³„
                </h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="totalFeedbacks">0</span>
                        <div class="stat-label">ì´ í”¼ë“œë°±</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="positiveFeedbacks">0</span>
                        <div class="stat-label">ê¸ì •ì  í”¼ë“œë°±</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="constructiveFeedbacks">0</span>
                        <div class="stat-label">ê°œì„  ì œì•ˆ</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="questionFeedbacks">0</span>
                        <div class="stat-label">ì§ˆë¬¸</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="activeParticipants">0</span>
                        <div class="stat-label">ì°¸ì—¬ì</div>
                    </div>
                </div>
            </div>

            <!-- í”¼ë“œë°± ë³´ë“œ -->
            <div class="feedback-board">
                <div class="feedback-column">
                    <div class="column-header">
                        <i class="fas fa-thumbs-up"></i>
                        ê¸ì •ì  í”¼ë“œë°±
                    </div>
                    <div class="column-content" id="positiveFeedbackColumn">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="empty-text">ì•„ì§ ê¸ì •ì  í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>

                <div class="feedback-column">
                    <div class="column-header">
                        <i class="fas fa-lightbulb"></i>
                        ê°œì„  ì œì•ˆ
                    </div>
                    <div class="column-content" id="constructiveFeedbackColumn">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="empty-text">ì•„ì§ ê°œì„  ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>

                <div class="feedback-column">
                    <div class="column-header">
                        <i class="fas fa-question-circle"></i>
                        ì§ˆë¬¸
                    </div>
                    <div class="column-content" id="questionFeedbackColumn">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="empty-text">ì•„ì§ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="clearBoard()">
                    <i class="fas fa-eraser"></i>
                    ë³´ë“œ ì´ˆê¸°í™”
                </button>
                <button class="btn btn-outline" onclick="exportFeedbacks()">
                    <i class="fas fa-download"></i>
                    í”¼ë“œë°± ë‚´ë³´ë‚´ê¸°
                </button>
                <button class="btn btn-outline" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i>
                    ë¶„ì„ ë¦¬í¬íŠ¸
                </button>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="common.js"></script>
    <script>
        class FeedbackBoard {
            constructor() {
                this.feedbacks = [];
                this.participants = new Set();
                this.selectedFeedbackType = 'positive';
                this.init();
            }

            init() {
                this.loadFromStorage();
                this.bindEvents();
                this.updateStats();
                this.renderFeedbacks();
                this.generateRoomCode();
            }

            bindEvents() {
                // í”¼ë“œë°± í¼ ì œì¶œ
                document.getElementById('feedbackForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitFeedback();
                });

                // í”¼ë“œë°± ìœ í˜• ì„ íƒ
                document.querySelectorAll('.feedback-type-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.querySelectorAll('.feedback-type-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.selectedFeedbackType = btn.dataset.type;
                    });
                });

                // ìë™ ì €ì¥ (30ì´ˆë§ˆë‹¤)
                setInterval(() => {
                    this.autoSave();
                }, 30000);

                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜ (5ì´ˆë§ˆë‹¤)
                setInterval(() => {
                    this.simulateRealTimeUpdate();
                }, 5000);
            }

            generateRoomCode() {
                const codes = ['HTHT2024', 'SEL2024', 'AIDT2024', 'PROJ2024'];
                const roomCode = codes[Math.floor(Math.random() * codes.length)];
                document.getElementById('roomCode').textContent = roomCode;
            }

            submitFeedback() {
                const userName = document.getElementById('userName').value.trim();
                const teamName = document.getElementById('teamName').value.trim();
                const targetTeam = document.getElementById('targetTeam').value;
                const content = document.getElementById('feedbackContent').value.trim();
                const selCompetency = document.getElementById('selCompetency').value;

                if (!userName) {
                    HTHT.Toast.show('ì°¸ì—¬ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                if (!targetTeam) {
                    HTHT.Toast.show('ëŒ€ìƒ ëª¨ë‘ ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                if (!content) {
                    HTHT.Toast.show('í”¼ë“œë°± ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                const feedback = {
                    id: Date.now(),
                    author: userName,
                    team: teamName || 'ë¯¸ì§€ì •',
                    targetTeam: targetTeam,
                    type: this.selectedFeedbackType,
                    content: content,
                    selCompetency: selCompetency,
                    timestamp: new Date(),
                    likes: 0,
                    replies: []
                };

                this.feedbacks.unshift(feedback);
                this.participants.add(userName);
                
                this.renderFeedbacks();
                this.updateStats();
                this.autoSave();

                // í¼ ì´ˆê¸°í™”
                document.getElementById('feedbackContent').value = '';
                document.getElementById('selCompetency').value = '';

                HTHT.Toast.show('í”¼ë“œë°±ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }

            renderFeedbacks() {
                const columns = {
                    positive: document.getElementById('positiveFeedbackColumn'),
                    constructive: document.getElementById('constructiveFeedbackColumn'),
                    question: document.getElementById('questionFeedbackColumn')
                };

                // ê° ì»¬ëŸ¼ ì´ˆê¸°í™”
                Object.values(columns).forEach(column => {
                    column.innerHTML = '';
                });

                // í”¼ë“œë°±ì´ ì—†ëŠ” ê²½ìš° ë¹ˆ ìƒíƒœ í‘œì‹œ
                const feedbacksByType = {
                    positive: this.feedbacks.filter(f => f.type === 'positive'),
                    constructive: this.feedbacks.filter(f => f.type === 'constructive'),
                    question: this.feedbacks.filter(f => f.type === 'question')
                };

                Object.keys(feedbacksByType).forEach(type => {
                    const feedbacks = feedbacksByType[type];
                    const column = columns[type];

                    if (feedbacks.length === 0) {
                        const emptyMessages = {
                            positive: 'ì•„ì§ ê¸ì •ì  í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤',
                            constructive: 'ì•„ì§ ê°œì„  ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤',
                            question: 'ì•„ì§ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤'
                        };

                        const emptyIcons = {
                            positive: 'fas fa-heart',
                            constructive: 'fas fa-lightbulb',
                            question: 'fas fa-question-circle'
                        };

                        column.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="${emptyIcons[type]}"></i>
                                </div>
                                <div class="empty-text">${emptyMessages[type]}</div>
                            </div>
                        `;
                    } else {
                        feedbacks.forEach(feedback => {
                            column.appendChild(this.createFeedbackCard(feedback));
                        });
                    }
                });
            }

            createFeedbackCard(feedback) {
                const card = document.createElement('div');
                card.className = `feedback-card ${feedback.type}`;
                
                const selCompetencyText = feedback.selCompetency ? 
                    this.getSelCompetencyText(feedback.selCompetency) : '';

                card.innerHTML = `
                    <div class="feedback-header">
                        <div class="feedback-author">${feedback.author}</div>
                        <div class="feedback-time">${this.formatTime(feedback.timestamp)}</div>
                    </div>
                    <div class="feedback-type-badge ${feedback.type}">
                        ${this.getFeedbackTypeText(feedback.type)}
                    </div>
                    <div class="feedback-content">${feedback.content}</div>
                    <div class="feedback-target">â†’ ${feedback.targetTeam}</div>
                    ${selCompetencyText ? `<div class="feedback-target">ğŸ¯ ${selCompetencyText}</div>` : ''}
                    <div class="feedback-actions">
                        <button class="feedback-action-btn" onclick="likeFeedback(${feedback.id})">
                            <i class="fas fa-thumbs-up"></i> ${feedback.likes}
                        </button>
                        <button class="feedback-action-btn" onclick="replyFeedback(${feedback.id})">
                            <i class="fas fa-reply"></i> ë‹µê¸€
                        </button>
                    </div>
                `;

                return card;
            }

            getFeedbackTypeText(type) {
                const types = {
                    positive: 'ê¸ì •ì ',
                    constructive: 'ê°œì„  ì œì•ˆ',
                    question: 'ì§ˆë¬¸'
                };
                return types[type] || type;
            }

            getSelCompetencyText(competency) {
                const competencies = {
                    selfAwareness: 'âœª ìê¸°ì¸ì‹',
                    selfManagement: 'â™¢ ìê¸°ê´€ë¦¬',
                    socialAwareness: 'â™§ ì‚¬íšŒì  ì¸ì‹',
                    relationshipSkills: 'â™¤ ê´€ê³„ ê¸°ìˆ ',
                    responsibleDecision: 'â˜… ì±…ì„ ìˆëŠ” ì˜ì‚¬ê²°ì •'
                };
                return competencies[competency] || competency;
            }

            formatTime(timestamp) {
                const now = new Date();
                const diff = now - new Date(timestamp);
                const minutes = Math.floor(diff / 60000);
                
                if (minutes < 1) return 'ë°©ê¸ˆ ì „';
                if (minutes < 60) return `${minutes}ë¶„ ì „`;
                
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours}ì‹œê°„ ì „`;
                
                return new Date(timestamp).toLocaleDateString('ko-KR');
            }

            updateStats() {
                const stats = {
                    total: this.feedbacks.length,
                    positive: this.feedbacks.filter(f => f.type === 'positive').length,
                    constructive: this.feedbacks.filter(f => f.type === 'constructive').length,
                    question: this.feedbacks.filter(f => f.type === 'question').length,
                    participants: this.participants.size
                };

                document.getElementById('totalFeedbacks').textContent = stats.total;
                document.getElementById('positiveFeedbacks').textContent = stats.positive;
                document.getElementById('constructiveFeedbacks').textContent = stats.constructive;
                document.getElementById('questionFeedbacks').textContent = stats.question;
                document.getElementById('activeParticipants').textContent = stats.participants;
            }

            simulateRealTimeUpdate() {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” WebSocketì´ë‚˜ Server-Sent Eventsë¥¼ ì‚¬ìš©
                // ì—¬ê¸°ì„œëŠ” ë°ëª¨ìš©ìœ¼ë¡œ ê°€ë” ìƒ˜í”Œ í”¼ë“œë°± ì¶”ê°€
                if (Math.random() < 0.1 && this.feedbacks.length < 20) {
                    const sampleFeedbacks = [
                        {
                            author: 'ê¹€ì„ ìƒ',
                            team: 'êµì‚¬',
                            targetTeam: '1ëª¨ë‘ ',
                            type: 'positive',
                            content: 'í”„ë ˆì  í…Œì´ì…˜ì´ ë§¤ìš° ì¸ìƒì ì´ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë°ì´í„° ì‹œê°í™” ë¶€ë¶„ì´ ë›°ì–´ë‚¬ì–´ìš”!',
                            selCompetency: 'selfAwareness'
                        },
                        {
                            author: 'ì´í•™ìƒ',
                            team: '2ëª¨ë‘ ',
                            targetTeam: '3ëª¨ë‘ ',
                            type: 'constructive',
                            content: 'ì•„ì´ë””ì–´ëŠ” ì¢‹ì§€ë§Œ ì‹¤í˜„ ê°€ëŠ¥ì„±ì— ëŒ€í•œ ê²€í† ê°€ ë” í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.',
                            selCompetency: 'responsibleDecision'
                        },
                        {
                            author: 'ë°•í•™ìƒ',
                            team: '4ëª¨ë‘ ',
                            targetTeam: '5ëª¨ë‘ ',
                            type: 'question',
                            content: 'AI ëª¨ë¸ì˜ ì •í™•ë„ëŠ” ì–´ëŠ ì •ë„ì¸ê°€ìš”? í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤.',
                            selCompetency: 'socialAwareness'
                        }
                    ];

                    const sample = sampleFeedbacks[Math.floor(Math.random() * sampleFeedbacks.length)];
                    const feedback = {
                        id: Date.now(),
                        ...sample,
                        timestamp: new Date(),
                        likes: Math.floor(Math.random() * 5),
                        replies: []
                    };

                    this.feedbacks.unshift(feedback);
                    this.participants.add(sample.author);
                    
                    this.renderFeedbacks();
                    this.updateStats();
                }
            }

            likeFeedback(feedbackId) {
                const feedback = this.feedbacks.find(f => f.id === feedbackId);
                if (feedback) {
                    feedback.likes++;
                    this.renderFeedbacks();
                    this.autoSave();
                }
            }

            replyFeedback(feedbackId) {
                const reply = prompt('ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”:');
                if (reply && reply.trim()) {
                    const feedback = this.feedbacks.find(f => f.id === feedbackId);
                    if (feedback) {
                        feedback.replies.push({
                            author: document.getElementById('userName').value || 'ìµëª…',
                            content: reply.trim(),
                            timestamp: new Date()
                        });
                        this.renderFeedbacks();
                        this.autoSave();
                        HTHT.Toast.show('ë‹µê¸€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                }
            }

            clearBoard() {
                if (confirm('ëª¨ë“  í”¼ë“œë°±ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.feedbacks = [];
                    this.participants.clear();
                    this.renderFeedbacks();
                    this.updateStats();
                    HTHT.Toast.show('í”¼ë“œë°± ë³´ë“œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                }
            }

            exportFeedbacks() {
                const exportData = {
                    title: 'ì‹¤ì‹œê°„ í”¼ë“œë°± ë³´ë“œ ë°ì´í„°',
                    timestamp: new Date().toISOString(),
                    roomCode: document.getElementById('roomCode').textContent,
                    feedbacks: this.feedbacks,
                    participants: Array.from(this.participants),
                    stats: {
                        total: this.feedbacks.length,
                        positive: this.feedbacks.filter(f => f.type === 'positive').length,
                        constructive: this.feedbacks.filter(f => f.type === 'constructive').length,
                        question: this.feedbacks.filter(f => f.type === 'question').length,
                        participants: this.participants.size
                    }
                };

                HTHT.ExportManager.downloadJSON(exportData, `í”¼ë“œë°±ë³´ë“œ_${new Date().toISOString().split('T')[0]}`);
                HTHT.Toast.show('í”¼ë“œë°± ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
            }

            generateReport() {
                const report = this.createAnalysisReport();
                HTHT.ExportManager.downloadText(report, `í”¼ë“œë°±ë¶„ì„ë¦¬í¬íŠ¸_${new Date().toISOString().split('T')[0]}`);
                HTHT.Toast.show('ë¶„ì„ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }

            createAnalysisReport() {
                const stats = {
                    total: this.feedbacks.length,
                    positive: this.feedbacks.filter(f => f.type === 'positive').length,
                    constructive: this.feedbacks.filter(f => f.type === 'constructive').length,
                    question: this.feedbacks.filter(f => f.type === 'question').length
                };

                const teamStats = {};
                this.feedbacks.forEach(feedback => {
                    if (!teamStats[feedback.targetTeam]) {
                        teamStats[feedback.targetTeam] = { positive: 0, constructive: 0, question: 0 };
                    }
                    teamStats[feedback.targetTeam][feedback.type]++;
                });

                return `
# ì‹¤ì‹œê°„ í”¼ë“œë°± ë³´ë“œ ë¶„ì„ ë¦¬í¬íŠ¸

ìƒì„±ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}
ë°© ì½”ë“œ: ${document.getElementById('roomCode').textContent}

## ì „ì²´ í†µê³„

- ì´ í”¼ë“œë°± ìˆ˜: ${stats.total}ê°œ
- ê¸ì •ì  í”¼ë“œë°±: ${stats.positive}ê°œ (${Math.round(stats.positive/stats.total*100) || 0}%)
- ê°œì„  ì œì•ˆ: ${stats.constructive}ê°œ (${Math.round(stats.constructive/stats.total*100) || 0}%)
- ì§ˆë¬¸: ${stats.question}ê°œ (${Math.round(stats.question/stats.total*100) || 0}%)
- ì°¸ì—¬ì ìˆ˜: ${this.participants.size}ëª…

## ëª¨ë‘ ë³„ í”¼ë“œë°± í˜„í™©

${Object.keys(teamStats).map(team => `
### ${team}
- ê¸ì •ì  í”¼ë“œë°±: ${teamStats[team].positive}ê°œ
- ê°œì„  ì œì•ˆ: ${teamStats[team].constructive}ê°œ
- ì§ˆë¬¸: ${teamStats[team].question}ê°œ
- ì´ í”¼ë“œë°±: ${teamStats[team].positive + teamStats[team].constructive + teamStats[team].question}ê°œ
`).join('')}

## SEL ì—­ëŸ‰ ì—°ê³„ ë¶„ì„

${this.analyzeSELCompetencies()}

## ì£¼ìš” í”¼ë“œë°± ë‚´ìš©

### ê¸ì •ì  í”¼ë“œë°± (ìƒìœ„ 3ê°œ)
${this.getTopFeedbacks('positive').map((f, i) => `${i+1}. "${f.content}" - ${f.author}`).join('\n')}

### ê°œì„  ì œì•ˆ (ìƒìœ„ 3ê°œ)
${this.getTopFeedbacks('constructive').map((f, i) => `${i+1}. "${f.content}" - ${f.author}`).join('\n')}

### ì§ˆë¬¸ (ìƒìœ„ 3ê°œ)
${this.getTopFeedbacks('question').map((f, i) => `${i+1}. "${f.content}" - ${f.author}`).join('\n')}

## ê°œì„  ì œì•ˆ

${this.generateImprovementSuggestions()}

---
HTHTÃ—SEL í”„ë¡œì íŠ¸ - ì‹¤ì‹œê°„ í”¼ë“œë°± ë³´ë“œ
                `.trim();
            }

            analyzeSELCompetencies() {
                const selStats = {};
                this.feedbacks.forEach(feedback => {
                    if (feedback.selCompetency) {
                        if (!selStats[feedback.selCompetency]) {
                            selStats[feedback.selCompetency] = 0;
                        }
                        selStats[feedback.selCompetency]++;
                    }
                });

                if (Object.keys(selStats).length === 0) {
                    return '- SEL ì—­ëŸ‰ê³¼ ì—°ê³„ëœ í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.';
                }

                return Object.keys(selStats).map(competency => 
                    `- ${this.getSelCompetencyText(competency)}: ${selStats[competency]}ê°œ`
                ).join('\n');
            }

            getTopFeedbacks(type) {
                return this.feedbacks
                    .filter(f => f.type === type)
                    .sort((a, b) => b.likes - a.likes)
                    .slice(0, 3);
            }

            generateImprovementSuggestions() {
                const suggestions = [];
                const stats = {
                    positive: this.feedbacks.filter(f => f.type === 'positive').length,
                    constructive: this.feedbacks.filter(f => f.type === 'constructive').length,
                    question: this.feedbacks.filter(f => f.type === 'question').length
                };

                if (stats.positive < stats.constructive) {
                    suggestions.push('- ê¸ì •ì  í”¼ë“œë°±ì„ ë” ë§ì´ ì£¼ê³ ë°›ì•„ ë™ê¸°ë¶€ì—¬ë¥¼ ë†’ì—¬ë³´ì„¸ìš”.');
                }

                if (stats.question < stats.total * 0.2) {
                    suggestions.push('- ê¶ê¸ˆí•œ ì ì„ ë” ì ê·¹ì ìœ¼ë¡œ ì§ˆë¬¸í•˜ì—¬ ê¹Šì´ ìˆëŠ” í•™ìŠµì„ í•´ë³´ì„¸ìš”.');
                }

                if (this.participants.size < 5) {
                    suggestions.push('- ë” ë§ì€ í•™ìƒë“¤ì´ í”¼ë“œë°±ì— ì°¸ì—¬í•  ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ë³´ì„¸ìš”.');
                }

                if (suggestions.length === 0) {
                    suggestions.push('- í˜„ì¬ í”¼ë“œë°± í™œë™ì´ ê· í˜•ìˆê²Œ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê³„ì† ìœ ì§€í•´ì£¼ì„¸ìš”!');
                }

                return suggestions.join('\n');
            }

            autoSave() {
                HTHT.StorageManager.save('feedbackBoard', {
                    feedbacks: this.feedbacks,
                    participants: Array.from(this.participants)
                });
            }

            loadFromStorage() {
                const savedData = HTHT.StorageManager.load('feedbackBoard');
                if (savedData) {
                    this.feedbacks = savedData.feedbacks || [];
                    this.participants = new Set(savedData.participants || []);
                }
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function likeFeedback(feedbackId) {
            window.feedbackBoard.likeFeedback(feedbackId);
        }

        function replyFeedback(feedbackId) {
            window.feedbackBoard.replyFeedback(feedbackId);
        }

        function clearBoard() {
            window.feedbackBoard.clearBoard();
        }

        function exportFeedbacks() {
            window.feedbackBoard.exportFeedbacks();
        }

        function generateReport() {
            window.feedbackBoard.generateReport();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            window.feedbackBoard = new FeedbackBoard();
        });
    </script>
</body>
</html>

