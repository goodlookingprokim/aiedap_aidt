<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTHT 프로젝트 설계 도구 - HTHT×SEL 프로젝트</title>
    <meta name="description" content="4단계 플로차트와 SEL 역량 매핑을 통한 체계적 HTHT 프로젝트 설계 도구">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    
    <style>
        .main-content {
            padding: var(--spacing-xl) 0;
            min-height: calc(100vh - 200px);
        }

        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto var(--spacing-lg);
            line-height: 1.6;
        }

        .tabs-container {
            display: flex;
            justify-content: center;
            margin-bottom: var(--spacing-xl);
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xs);
            box-shadow: var(--shadow-sm);
        }

        .tab-button {
            background: none;
            border: none;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .tab-button:hover {
            background: var(--bg-secondary);
        }

        .tab-button.active {
            background: var(--bg-gradient);
            color: var(--text-white);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        /* HTHT 매트릭스 스타일 */
        .matrix-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: var(--spacing-lg);
            min-height: 500px;
        }

        .matrix-quadrant {
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            position: relative;
            transition: var(--transition-normal);
            cursor: pointer;
        }

        .matrix-quadrant:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .matrix-quadrant.selected {
            border-color: var(--primary-color);
            background: var(--bg-gradient-light);
        }

        .quadrant-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .quadrant-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-gradient);
            color: var(--text-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .quadrant-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .quadrant-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            line-height: 1.5;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs) 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .activity-item i {
            color: var(--success-color);
            width: 16px;
        }

        /* 플로차트 스타일 */
        .flowchart-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .flowchart-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-xl);
            position: relative;
        }

        .flowchart-step {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            position: relative;
            border: 2px solid transparent;
            transition: var(--transition-normal);
        }

        .flowchart-step:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .flowchart-step.completed {
            border-color: var(--success-color);
            background: rgba(72, 187, 120, 0.1);
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-gradient);
            color: var(--text-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto var(--spacing-md);
        }

        .step-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .step-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            line-height: 1.5;
        }

        .step-input {
            width: 100%;
            min-height: 80px;
            padding: var(--spacing-sm);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            resize: vertical;
        }

        .step-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* SEL 균형 체크 스타일 */
        .sel-balance-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .sel-competencies {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .sel-competency {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: var(--transition-normal);
            border: 2px solid transparent;
        }

        .sel-competency:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .competency-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
            display: block;
        }

        .competency-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .competency-progress {
            background: var(--bg-tertiary);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--spacing-sm);
        }

        .competency-progress-fill {
            background: var(--bg-gradient);
            height: 100%;
            transition: width 0.3s ease;
        }

        .competency-percentage {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .balance-chart {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
        }

        .chart-placeholder {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(
                #667eea 0deg 72deg,
                #764ba2 72deg 144deg,
                #f093fb 144deg 216deg,
                #48bb78 216deg 288deg,
                #ed8936 288deg 360deg
            );
            margin: 0 auto var(--spacing-md);
            position: relative;
        }

        .chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: var(--bg-primary);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .chart-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .chart-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* 액션 버튼 */
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-top: var(--spacing-xl);
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .matrix-grid {
                grid-template-columns: 1fr;
                min-height: auto;
            }

            .flowchart-steps {
                grid-template-columns: 1fr;
            }

            .tabs-container {
                flex-direction: column;
                align-items: stretch;
            }

            .tab-button {
                justify-content: center;
            }

            .page-title {
                font-size: 2rem;
            }

            .chart-placeholder {
                width: 150px;
                height: 150px;
            }

            .chart-center {
                width: 90px;
                height: 90px;
            }
        }
    </style>
</head>
<body>
    <!-- 네비게이션은 common.js에서 자동 생성됩니다 -->

    <main class="main-content">
        <div class="container">
            <!-- 페이지 헤더 -->
            <div class="page-header">
                <h1 class="page-title">HTHT 프로젝트 설계 도구</h1>
                <p class="page-subtitle">
                    4단계 플로차트와 SEL 역량 매핑을 통한 체계적인 HTHT 프로젝트를 설계해보세요
                </p>
            </div>

            <!-- 탭 네비게이션 -->
            <div class="tabs-container">
                <button class="tab-button active" onclick="showTab('matrix')">
                    <i class="fas fa-th"></i>
                    HTHT 매트릭스
                </button>
                <button class="tab-button" onclick="showTab('flowchart')">
                    <i class="fas fa-project-diagram"></i>
                    4단계 플로차트
                </button>
                <button class="tab-button" onclick="showTab('sel-balance')">
                    <i class="fas fa-balance-scale"></i>
                    SEL 균형 점검
                </button>
            </div>

            <!-- HTHT 매트릭스 탭 -->
            <div id="matrix" class="tab-content active">
                <div class="matrix-container">
                    <h2 style="text-align: center; margin-bottom: var(--spacing-xl); color: var(--text-primary);">
                        HTHT 활동 매트릭스
                    </h2>
                    <div class="matrix-grid">
                        <!-- High-Tech High-Touch -->
                        <div class="matrix-quadrant" data-quadrant="ht-ht" onclick="selectQuadrant('ht-ht')">
                            <div class="quadrant-header">
                                <div class="quadrant-icon">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <div class="quadrant-title">High-Tech High-Touch</div>
                            </div>
                            <div class="quadrant-description">
                                첨단 기술과 인간적 소통이 조화된 활동
                            </div>
                            <ul class="activity-list">
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    AI 챗봇과 대화하며 협력 문제 해결
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    VR 환경에서 팀 프로젝트 수행
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    실시간 온라인 토론 및 피드백
                                </li>
                            </ul>
                        </div>

                        <!-- High-Tech Low-Touch -->
                        <div class="matrix-quadrant" data-quadrant="ht-lt" onclick="selectQuadrant('ht-lt')">
                            <div class="quadrant-header">
                                <div class="quadrant-icon">
                                    <i class="fas fa-laptop"></i>
                                </div>
                                <div class="quadrant-title">High-Tech Low-Touch</div>
                            </div>
                            <div class="quadrant-description">
                                개인적 기술 활용 중심의 활동
                            </div>
                            <ul class="activity-list">
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    개인별 AI 도구 활용 학습
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    자기주도적 온라인 탐구
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    디지털 포트폴리오 제작
                                </li>
                            </ul>
                        </div>

                        <!-- Low-Tech High-Touch -->
                        <div class="matrix-quadrant" data-quadrant="lt-ht" onclick="selectQuadrant('lt-ht')">
                            <div class="quadrant-header">
                                <div class="quadrant-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="quadrant-title">Low-Tech High-Touch</div>
                            </div>
                            <div class="quadrant-description">
                                대면 소통과 협력 중심의 활동
                            </div>
                            <ul class="activity-list">
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    모둠 토의 및 브레인스토밍
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    역할극 및 시뮬레이션
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    오프라인 워크숍 활동
                                </li>
                            </ul>
                        </div>

                        <!-- Low-Tech Low-Touch -->
                        <div class="matrix-quadrant" data-quadrant="lt-lt" onclick="selectQuadrant('lt-lt')">
                            <div class="quadrant-header">
                                <div class="quadrant-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="quadrant-title">Low-Tech Low-Touch</div>
                            </div>
                            <div class="quadrant-description">
                                개인적 성찰과 기초 학습 활동
                            </div>
                            <ul class="activity-list">
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    개인 저널 작성 및 성찰
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    독서 및 자료 분석
                                </li>
                                <li class="activity-item">
                                    <i class="fas fa-check"></i>
                                    개념 정리 및 요약
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4단계 플로차트 탭 -->
            <div id="flowchart" class="tab-content">
                <div class="flowchart-container">
                    <h2 style="text-align: center; margin-bottom: var(--spacing-xl); color: var(--text-primary);">
                        HTHT 프로젝트 4단계 플로차트
                    </h2>
                    <div class="flowchart-steps">
                        <div class="flowchart-step" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-title">문제 인식 및 정의</div>
                            <div class="step-description">
                                해결하고자 하는 문제를 명확히 정의하고 목표를 설정합니다.
                            </div>
                            <textarea 
                                class="step-input" 
                                id="step1Input"
                                placeholder="예: 학급 내 소통 부족 문제를 해결하여 협력적 학습 환경을 조성한다."
                            ></textarea>
                        </div>

                        <div class="flowchart-step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-title">HTHT 활동 설계</div>
                            <div class="step-description">
                                매트릭스를 바탕으로 균형잡힌 HTHT 활동을 설계합니다.
                            </div>
                            <textarea 
                                class="step-input" 
                                id="step2Input"
                                placeholder="예: AI 챗봇 활용(HT-HT) + 모둠 토의(LT-HT) + 개인 성찰(LT-LT) 조합"
                            ></textarea>
                        </div>

                        <div class="flowchart-step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-title">SEL 역량 매핑</div>
                            <div class="step-description">
                                각 활동이 어떤 SEL 역량을 개발하는지 매핑합니다.
                            </div>
                            <textarea 
                                class="step-input" 
                                id="step3Input"
                                placeholder="예: 자기인식(성찰 활동), 관계 기술(모둠 토의), 사회적 인식(AI와의 대화)"
                            ></textarea>
                        </div>

                        <div class="flowchart-step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-title">평가 및 개선</div>
                            <div class="step-description">
                                프로젝트 결과를 평가하고 개선 방안을 도출합니다.
                            </div>
                            <textarea 
                                class="step-input" 
                                id="step4Input"
                                placeholder="예: SEL 역량 루브릭 평가, 학생 피드백 수집, 다음 프로젝트 개선점 도출"
                            ></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEL 균형 점검 탭 -->
            <div id="sel-balance" class="tab-content">
                <div class="sel-balance-container">
                    <h2 style="text-align: center; margin-bottom: var(--spacing-xl); color: var(--text-primary);">
                        SEL 역량 균형 점검
                    </h2>
                    
                    <div class="sel-competencies">
                        <div class="sel-competency">
                            <span class="competency-icon">✪</span>
                            <div class="competency-name">자기인식</div>
                            <div class="competency-progress">
                                <div class="competency-progress-fill" id="selfAwareness" style="width: 0%"></div>
                            </div>
                            <div class="competency-percentage" id="selfAwarenessPercent">0%</div>
                        </div>

                        <div class="sel-competency">
                            <span class="competency-icon">♢</span>
                            <div class="competency-name">자기관리</div>
                            <div class="competency-progress">
                                <div class="competency-progress-fill" id="selfManagement" style="width: 0%"></div>
                            </div>
                            <div class="competency-percentage" id="selfManagementPercent">0%</div>
                        </div>

                        <div class="sel-competency">
                            <span class="competency-icon">♧</span>
                            <div class="competency-name">사회적 인식</div>
                            <div class="competency-progress">
                                <div class="competency-progress-fill" id="socialAwareness" style="width: 0%"></div>
                            </div>
                            <div class="competency-percentage" id="socialAwarenessPercent">0%</div>
                        </div>

                        <div class="sel-competency">
                            <span class="competency-icon">♤</span>
                            <div class="competency-name">관계 기술</div>
                            <div class="competency-progress">
                                <div class="competency-progress-fill" id="relationshipSkills" style="width: 0%"></div>
                            </div>
                            <div class="competency-percentage" id="relationshipSkillsPercent">0%</div>
                        </div>

                        <div class="sel-competency">
                            <span class="competency-icon">★</span>
                            <div class="competency-name">책임 있는 의사결정</div>
                            <div class="competency-progress">
                                <div class="competency-progress-fill" id="responsibleDecision" style="width: 0%"></div>
                            </div>
                            <div class="competency-percentage" id="responsibleDecisionPercent">0%</div>
                        </div>
                    </div>

                    <div class="balance-chart">
                        <div class="chart-placeholder">
                            <div class="chart-center">
                                <div class="chart-score" id="balanceScore">0</div>
                                <div class="chart-label">균형 점수</div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin-top: var(--spacing-md);">
                            모든 SEL 역량이 균형있게 개발될수록 높은 점수를 받습니다.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 액션 버튼 -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="clearProject()">
                    <i class="fas fa-eraser"></i>
                    초기화
                </button>
                <button class="btn btn-outline" onclick="saveProject()">
                    <i class="fas fa-save"></i>
                    저장하기
                </button>
                <button class="btn btn-outline" onclick="loadProject()">
                    <i class="fas fa-folder-open"></i>
                    불러오기
                </button>
                <button class="btn btn-primary" onclick="exportProject()">
                    <i class="fas fa-download"></i>
                    설계안 내보내기
                </button>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="common.js"></script>
    <script>
        class HTHTProjectDesigner {
            constructor() {
                this.data = {
                    selectedQuadrant: null,
                    steps: {
                        step1: '',
                        step2: '',
                        step3: '',
                        step4: ''
                    },
                    selCompetencies: {
                        selfAwareness: 0,
                        selfManagement: 0,
                        socialAwareness: 0,
                        relationshipSkills: 0,
                        responsibleDecision: 0
                    }
                };
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadFromStorage();
                this.updateSELBalance();
            }

            bindEvents() {
                // 플로차트 입력 이벤트
                const stepInputs = document.querySelectorAll('.step-input');
                stepInputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        const stepId = e.target.id;
                        this.data.steps[stepId.replace('Input', '')] = e.target.value;
                        this.updateStepCompletion(e.target);
                        this.analyzeSELContent();
                        this.autoSave();
                    });
                });

                // 자동 저장 (10초마다)
                setInterval(() => {
                    this.autoSave();
                }, 10000);
            }

            updateStepCompletion(input) {
                const step = input.closest('.flowchart-step');
                if (input.value.trim().length > 0) {
                    step.classList.add('completed');
                } else {
                    step.classList.remove('completed');
                }
            }

            analyzeSELContent() {
                // 간단한 키워드 기반 SEL 역량 분석
                const allText = Object.values(this.data.steps).join(' ').toLowerCase();
                
                // 키워드 매핑
                const keywords = {
                    selfAwareness: ['성찰', '자기', '인식', '감정', '생각', '느낌', '자아'],
                    selfManagement: ['관리', '조절', '계획', '목표', '집중', '인내', '자제'],
                    socialAwareness: ['타인', '공감', '이해', '관찰', '사회', '문화', '다양성'],
                    relationshipSkills: ['소통', '협력', '관계', '팀', '모둠', '대화', '협상'],
                    responsibleDecision: ['결정', '선택', '판단', '책임', '윤리', '도덕', '가치']
                };

                // 각 역량별 점수 계산
                Object.keys(keywords).forEach(competency => {
                    let score = 0;
                    keywords[competency].forEach(keyword => {
                        const matches = (allText.match(new RegExp(keyword, 'g')) || []).length;
                        score += matches * 10;
                    });
                    this.data.selCompetencies[competency] = Math.min(score, 100);
                });

                this.updateSELBalance();
            }

            updateSELBalance() {
                Object.keys(this.data.selCompetencies).forEach(competency => {
                    const percentage = this.data.selCompetencies[competency];
                    const progressBar = document.getElementById(competency);
                    const percentageLabel = document.getElementById(competency + 'Percent');
                    
                    if (progressBar && percentageLabel) {
                        progressBar.style.width = percentage + '%';
                        percentageLabel.textContent = percentage + '%';
                    }
                });

                // 균형 점수 계산 (표준편차 기반)
                const values = Object.values(this.data.selCompetencies);
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
                const standardDeviation = Math.sqrt(variance);
                const balanceScore = Math.max(0, Math.round(100 - standardDeviation));
                
                document.getElementById('balanceScore').textContent = balanceScore;
            }

            autoSave() {
                HTHT.StorageManager.save('hthtProject', this.data);
            }

            saveProject() {
                HTHT.StorageManager.save('hthtProject', this.data);
                HTHT.Toast.show('프로젝트가 저장되었습니다.', 'success');
            }

            loadProject() {
                const savedData = HTHT.StorageManager.load('hthtProject');
                if (savedData) {
                    this.data = { ...this.data, ...savedData };
                    this.populateFields();
                    HTHT.Toast.show('저장된 프로젝트를 불러왔습니다.', 'success');
                } else {
                    HTHT.Toast.show('저장된 데이터가 없습니다.', 'info');
                }
            }

            loadFromStorage() {
                const savedData = HTHT.StorageManager.load('hthtProject');
                if (savedData) {
                    this.data = { ...this.data, ...savedData };
                    this.populateFields();
                }
            }

            populateFields() {
                // 플로차트 입력 필드 채우기
                Object.keys(this.data.steps).forEach(step => {
                    const input = document.getElementById(step + 'Input');
                    if (input) {
                        input.value = this.data.steps[step];
                        this.updateStepCompletion(input);
                    }
                });

                // 선택된 사분면 표시
                if (this.data.selectedQuadrant) {
                    const quadrant = document.querySelector(`[data-quadrant="${this.data.selectedQuadrant}"]`);
                    if (quadrant) {
                        quadrant.classList.add('selected');
                    }
                }

                this.updateSELBalance();
            }

            clearProject() {
                if (confirm('모든 내용을 초기화하시겠습니까?')) {
                    this.data = {
                        selectedQuadrant: null,
                        steps: {
                            step1: '',
                            step2: '',
                            step3: '',
                            step4: ''
                        },
                        selCompetencies: {
                            selfAwareness: 0,
                            selfManagement: 0,
                            socialAwareness: 0,
                            relationshipSkills: 0,
                            responsibleDecision: 0
                        }
                    };

                    // UI 초기화
                    document.querySelectorAll('.step-input').forEach(input => {
                        input.value = '';
                        input.closest('.flowchart-step').classList.remove('completed');
                    });

                    document.querySelectorAll('.matrix-quadrant.selected').forEach(quadrant => {
                        quadrant.classList.remove('selected');
                    });

                    this.updateSELBalance();
                    HTHT.Toast.show('프로젝트가 초기화되었습니다.', 'info');
                }
            }

            exportProject() {
                const exportData = {
                    title: 'HTHT 프로젝트 설계안',
                    timestamp: new Date().toISOString(),
                    data: this.data,
                    analysis: this.generateAnalysis()
                };

                // JSON 파일로 내보내기
                HTHT.ExportManager.downloadJSON(exportData, `HTHT프로젝트설계안_${new Date().toISOString().split('T')[0]}`);

                // 텍스트 리포트 생성
                const report = this.generateTextReport();
                HTHT.ExportManager.downloadText(report, `HTHT프로젝트리포트_${new Date().toISOString().split('T')[0]}`);

                HTHT.Toast.show('설계안이 성공적으로 내보내졌습니다.', 'success');
            }

            generateAnalysis() {
                const completedSteps = Object.values(this.data.steps).filter(step => step.trim().length > 0).length;
                const selValues = Object.values(this.data.selCompetencies);
                const averageSEL = selValues.reduce((a, b) => a + b, 0) / selValues.length;
                
                return {
                    completedSteps: completedSteps,
                    totalSteps: 4,
                    completionRate: Math.round((completedSteps / 4) * 100),
                    selectedQuadrant: this.data.selectedQuadrant,
                    averageSEL: Math.round(averageSEL),
                    balanceScore: parseInt(document.getElementById('balanceScore').textContent)
                };
            }

            generateTextReport() {
                const analysis = this.generateAnalysis();
                
                return `
# HTHT 프로젝트 설계안

생성일시: ${new Date().toLocaleString('ko-KR')}

## 프로젝트 개요
- 완성률: ${analysis.completionRate}%
- 선택된 매트릭스: ${this.data.selectedQuadrant || '미선택'}
- SEL 균형 점수: ${analysis.balanceScore}/100

## 4단계 플로차트

### 1단계: 문제 인식 및 정의
${this.data.steps.step1 || '미작성'}

### 2단계: HTHT 활동 설계
${this.data.steps.step2 || '미작성'}

### 3단계: SEL 역량 매핑
${this.data.steps.step3 || '미작성'}

### 4단계: 평가 및 개선
${this.data.steps.step4 || '미작성'}

## SEL 역량 분석

- ✪ 자기인식: ${this.data.selCompetencies.selfAwareness}%
- ♢ 자기관리: ${this.data.selCompetencies.selfManagement}%
- ♧ 사회적 인식: ${this.data.selCompetencies.socialAwareness}%
- ♤ 관계 기술: ${this.data.selCompetencies.relationshipSkills}%
- ★ 책임 있는 의사결정: ${this.data.selCompetencies.responsibleDecision}%

## 추천 사항

${this.generateRecommendations().map(rec => `- ${rec}`).join('\n')}

---
HTHT×SEL 프로젝트 - HTHT 프로젝트 설계 도구
                `.trim();
            }

            generateRecommendations() {
                const recommendations = [];
                const selValues = this.data.selCompetencies;
                
                // 낮은 SEL 역량에 대한 추천
                Object.keys(selValues).forEach(competency => {
                    if (selValues[competency] < 30) {
                        const competencyNames = {
                            selfAwareness: '자기인식',
                            selfManagement: '자기관리',
                            socialAwareness: '사회적 인식',
                            relationshipSkills: '관계 기술',
                            responsibleDecision: '책임 있는 의사결정'
                        };
                        recommendations.push(`${competencyNames[competency]} 역량을 강화하는 활동 추가 필요`);
                    }
                });

                if (recommendations.length === 0) {
                    recommendations.push('SEL 역량이 균형있게 설계되었습니다.');
                }

                return recommendations;
            }
        }

        // 전역 함수들
        function showTab(tabName) {
            // 모든 탭 비활성화
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // 선택된 탭 활성화
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function selectQuadrant(quadrant) {
            // 기존 선택 해제
            document.querySelectorAll('.matrix-quadrant.selected').forEach(q => q.classList.remove('selected'));
            
            // 새 선택 적용
            const quadrantElement = document.querySelector(`[data-quadrant="${quadrant}"]`);
            quadrantElement.classList.add('selected');
            
            window.designer.data.selectedQuadrant = quadrant;
            window.designer.autoSave();
            
            HTHT.Toast.show(`${quadrantElement.querySelector('.quadrant-title').textContent} 영역이 선택되었습니다.`, 'success');
        }

        function clearProject() {
            window.designer.clearProject();
        }

        function saveProject() {
            window.designer.saveProject();
        }

        function loadProject() {
            window.designer.loadProject();
        }

        function exportProject() {
            window.designer.exportProject();
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            window.designer = new HTHTProjectDesigner();
        });
    </script>
</body>
</html>

