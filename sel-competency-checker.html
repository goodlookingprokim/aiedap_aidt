<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEL 역량 체크리스트 - HTHT×SEL 프로젝트</title>
    <meta name="description" content="5대 SEL 역량의 균형적 발달을 점검하고 개선 방안을 찾는 체크리스트 도구">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    
    <style>
        .main-content {
            padding: var(--spacing-xl) 0;
            min-height: calc(100vh - 200px);
        }

        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto var(--spacing-lg);
            line-height: 1.6;
        }

        /* 대시보드 스타일 */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .dashboard-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
        }

        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .dashboard-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--bg-gradient);
            color: var(--text-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto var(--spacing-md);
        }

        .dashboard-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
            margin-bottom: var(--spacing-xs);
        }

        .dashboard-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* SEL 역량 섹션 스타일 */
        .competency-section {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--spacing-xl);
            overflow: hidden;
        }

        .competency-header {
            background: var(--bg-gradient);
            color: var(--text-white);
            padding: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .competency-header:hover {
            background: var(--primary-dark);
        }

        .competency-icon {
            font-size: 2rem;
            width: 60px;
            text-align: center;
        }

        .competency-info {
            flex: 1;
        }

        .competency-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .competency-description {
            opacity: 0.9;
            font-size: 1rem;
        }

        .competency-progress {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .progress-bar-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background: var(--text-white);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-percentage {
            font-weight: 600;
            min-width: 50px;
            text-align: right;
        }

        .expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .competency-content {
            padding: var(--spacing-lg);
            display: none;
        }

        .competency-content.expanded {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .competency-section.expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* 체크리스트 스타일 */
        .checklist {
            display: grid;
            gap: var(--spacing-md);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
        }

        .checklist-item:hover {
            background: var(--bg-tertiary);
        }

        .checklist-item.checked {
            background: rgba(72, 187, 120, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox:hover {
            border-color: var(--primary-color);
        }

        .checkbox.checked {
            background: var(--success-color);
            border-color: var(--success-color);
            color: var(--text-white);
        }

        .checklist-text {
            flex: 1;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .checklist-item.checked .checklist-text {
            color: var(--text-secondary);
        }

        /* 분석 결과 스타일 */
        .analysis-section {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-lg);
            text-align: center;
        }

        .radar-chart {
            width: 300px;
            height: 300px;
            margin: 0 auto var(--spacing-lg);
            position: relative;
        }

        .radar-chart svg {
            width: 100%;
            height: 100%;
        }

        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .recommendation-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border-left: 4px solid var(--primary-color);
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .recommendation-text {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        /* 액션 버튼 */
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-top: var(--spacing-xl);
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .competency-header {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-sm);
            }

            .competency-progress {
                width: 100%;
            }

            .page-title {
                font-size: 2rem;
            }

            .radar-chart {
                width: 250px;
                height: 250px;
            }

            .recommendations {
                grid-template-columns: 1fr;
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }
    </style>
</head>
<body>
    <!-- 네비게이션은 common.js에서 자동 생성됩니다 -->

    <main class="main-content">
        <div class="container">
            <!-- 페이지 헤더 -->
            <div class="page-header">
                <h1 class="page-title">SEL 역량 체크리스트</h1>
                <p class="page-subtitle">
                    5대 SEL 역량의 균형적 발달을 점검하고 개인별 성장 계획을 수립해보세요
                </p>
            </div>

            <!-- 대시보드 -->
            <div class="dashboard">
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <span class="dashboard-number" id="totalItems">0</span>
                    <div class="dashboard-label">총 체크 항목</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="dashboard-number" id="completedItems">0</span>
                    <div class="dashboard-label">완료된 항목</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <span class="dashboard-number" id="completionRate">0%</span>
                    <div class="dashboard-label">전체 완성률</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <span class="dashboard-number" id="balanceScore">0</span>
                    <div class="dashboard-label">균형 점수</div>
                </div>
            </div>

            <!-- SEL 역량 섹션들 -->
            <div id="competencySections">
                <!-- JavaScript에서 동적 생성 -->
            </div>

            <!-- 분석 결과 섹션 -->
            <div class="analysis-section">
                <h2 class="analysis-title">📊 SEL 역량 분석 결과</h2>
                
                <div class="radar-chart" id="radarChart">
                    <!-- SVG 차트가 여기에 생성됩니다 -->
                </div>

                <div class="recommendations" id="recommendations">
                    <!-- 추천 사항이 여기에 생성됩니다 -->
                </div>
            </div>

            <!-- 액션 버튼 -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetChecklist()">
                    <i class="fas fa-undo"></i>
                    초기화
                </button>
                <button class="btn btn-outline" onclick="saveProgress()">
                    <i class="fas fa-save"></i>
                    진행상황 저장
                </button>
                <button class="btn btn-outline" onclick="loadProgress()">
                    <i class="fas fa-folder-open"></i>
                    불러오기
                </button>
                <button class="btn btn-primary" onclick="exportReport()">
                    <i class="fas fa-file-alt"></i>
                    리포트 생성
                </button>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="common.js"></script>
    <script>
        class SELCompetencyChecker {
            constructor() {
                this.competencies = {
                    selfAwareness: {
                        icon: '✪',
                        title: '자기인식',
                        description: '자신의 감정, 생각, 가치관을 이해하고 인식하는 능력',
                        items: [
                            '나는 내 감정을 정확히 파악할 수 있다',
                            '나는 내 강점과 약점을 알고 있다',
                            '나는 내 가치관이 무엇인지 명확히 안다',
                            '나는 스트레스를 받을 때 그 원인을 파악할 수 있다',
                            '나는 내 행동이 다른 사람에게 미치는 영향을 안다',
                            '나는 내 목표와 꿈이 무엇인지 알고 있다',
                            '나는 내 학습 스타일을 이해하고 있다',
                            '나는 어려운 상황에서 내 반응을 객관적으로 관찰할 수 있다'
                        ]
                    },
                    selfManagement: {
                        icon: '♢',
                        title: '자기관리',
                        description: '감정과 행동을 효과적으로 조절하고 목표를 달성하는 능력',
                        items: [
                            '나는 화가 날 때 감정을 조절할 수 있다',
                            '나는 계획을 세우고 그대로 실행할 수 있다',
                            '나는 유혹에 빠지지 않고 목표에 집중할 수 있다',
                            '나는 스트레스를 건강한 방법으로 해소한다',
                            '나는 실패했을 때 다시 일어설 수 있다',
                            '나는 시간을 효율적으로 관리한다',
                            '나는 충동적인 행동을 자제할 수 있다',
                            '나는 어려운 과제도 끝까지 완수한다'
                        ]
                    },
                    socialAwareness: {
                        icon: '♧',
                        title: '사회적 인식',
                        description: '다른 사람의 감정과 관점을 이해하고 공감하는 능력',
                        items: [
                            '나는 다른 사람의 감정을 잘 파악할 수 있다',
                            '나는 다른 사람의 입장에서 생각할 수 있다',
                            '나는 비언어적 신호(표정, 몸짓)를 잘 읽는다',
                            '나는 다양한 문화와 배경을 가진 사람들을 존중한다',
                            '나는 집단 내 분위기를 잘 파악한다',
                            '나는 다른 사람이 도움이 필요할 때 알아차린다',
                            '나는 사회적 규범과 기대를 이해한다',
                            '나는 불공정한 상황을 인식하고 대응할 수 있다'
                        ]
                    },
                    relationshipSkills: {
                        icon: '♤',
                        title: '관계 기술',
                        description: '건강한 관계를 형성하고 유지하며 갈등을 해결하는 능력',
                        items: [
                            '나는 다른 사람과 쉽게 대화를 시작할 수 있다',
                            '나는 팀워크를 발휘하여 협력할 수 있다',
                            '나는 갈등 상황을 평화롭게 해결할 수 있다',
                            '나는 다른 사람의 의견을 경청한다',
                            '나는 도움이 필요할 때 요청할 수 있다',
                            '나는 다른 사람에게 도움을 제공한다',
                            '나는 건설적인 피드백을 주고받을 수 있다',
                            '나는 다양한 사람들과 친밀한 관계를 맺는다'
                        ]
                    },
                    responsibleDecision: {
                        icon: '★',
                        title: '책임 있는 의사결정',
                        description: '윤리적이고 건설적인 선택을 하며 그 결과에 책임지는 능력',
                        items: [
                            '나는 결정을 내리기 전에 충분히 생각한다',
                            '나는 내 행동의 결과를 예측할 수 있다',
                            '나는 옳고 그름을 구별할 수 있다',
                            '나는 어려운 상황에서도 올바른 선택을 한다',
                            '나는 내 결정에 대해 책임을 진다',
                            '나는 다른 사람의 복지를 고려하여 결정한다',
                            '나는 장기적 관점에서 판단한다',
                            '나는 실수를 인정하고 개선하려고 노력한다'
                        ]
                    }
                };

                this.checkedItems = {};
                this.init();
            }

            init() {
                this.loadFromStorage();
                this.createCompetencySections();
                this.updateDashboard();
                this.updateAnalysis();
                this.bindEvents();
            }

            createCompetencySections() {
                const container = document.getElementById('competencySections');
                container.innerHTML = '';

                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const section = document.createElement('div');
                    section.className = 'competency-section';
                    section.innerHTML = `
                        <div class="competency-header" onclick="toggleSection('${key}')">
                            <div class="competency-icon">${competency.icon}</div>
                            <div class="competency-info">
                                <div class="competency-title">${competency.title}</div>
                                <div class="competency-description">${competency.description}</div>
                            </div>
                            <div class="competency-progress">
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" id="progress-${key}"></div>
                                </div>
                                <div class="progress-percentage" id="percentage-${key}">0%</div>
                            </div>
                            <div class="expand-icon">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                        <div class="competency-content" id="content-${key}">
                            <div class="checklist">
                                ${competency.items.map((item, index) => `
                                    <div class="checklist-item" id="item-${key}-${index}">
                                        <div class="checkbox" onclick="toggleItem('${key}', ${index})">
                                            <i class="fas fa-check" style="display: none;"></i>
                                        </div>
                                        <div class="checklist-text">${item}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    container.appendChild(section);
                });

                this.updateCheckboxes();
            }

            updateCheckboxes() {
                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    competency.items.forEach((item, index) => {
                        const itemElement = document.getElementById(`item-${key}-${index}`);
                        const checkbox = itemElement.querySelector('.checkbox');
                        const checkIcon = checkbox.querySelector('i');
                        
                        if (this.checkedItems[`${key}-${index}`]) {
                            itemElement.classList.add('checked');
                            checkbox.classList.add('checked');
                            checkIcon.style.display = 'block';
                        } else {
                            itemElement.classList.remove('checked');
                            checkbox.classList.remove('checked');
                            checkIcon.style.display = 'none';
                        }
                    });
                });
            }

            toggleItem(competencyKey, itemIndex) {
                const itemId = `${competencyKey}-${itemIndex}`;
                this.checkedItems[itemId] = !this.checkedItems[itemId];
                
                this.updateCheckboxes();
                this.updateDashboard();
                this.updateAnalysis();
                this.autoSave();
            }

            updateDashboard() {
                const totalItems = Object.keys(this.competencies).reduce((sum, key) => 
                    sum + this.competencies[key].items.length, 0);
                
                const completedItems = Object.values(this.checkedItems).filter(Boolean).length;
                const completionRate = Math.round((completedItems / totalItems) * 100);
                
                // 각 역량별 진행률 계산
                const competencyScores = {};
                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const checkedCount = competency.items.filter((item, index) => 
                        this.checkedItems[`${key}-${index}`]).length;
                    const score = Math.round((checkedCount / competency.items.length) * 100);
                    competencyScores[key] = score;
                    
                    // 진행률 바 업데이트
                    const progressBar = document.getElementById(`progress-${key}`);
                    const percentage = document.getElementById(`percentage-${key}`);
                    if (progressBar && percentage) {
                        progressBar.style.width = score + '%';
                        percentage.textContent = score + '%';
                    }
                });

                // 균형 점수 계산 (표준편차 기반)
                const scores = Object.values(competencyScores);
                const mean = scores.reduce((a, b) => a + b, 0) / scores.length;
                const variance = scores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / scores.length;
                const standardDeviation = Math.sqrt(variance);
                const balanceScore = Math.max(0, Math.round(100 - standardDeviation));

                // 대시보드 업데이트
                document.getElementById('totalItems').textContent = totalItems;
                document.getElementById('completedItems').textContent = completedItems;
                document.getElementById('completionRate').textContent = completionRate + '%';
                document.getElementById('balanceScore').textContent = balanceScore;
            }

            updateAnalysis() {
                this.createRadarChart();
                this.generateRecommendations();
            }

            createRadarChart() {
                const container = document.getElementById('radarChart');
                const size = 300;
                const center = size / 2;
                const radius = 100;

                // 각 역량별 점수 계산
                const scores = {};
                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const checkedCount = competency.items.filter((item, index) => 
                        this.checkedItems[`${key}-${index}`]).length;
                    scores[key] = (checkedCount / competency.items.length) * 100;
                });

                const competencyKeys = Object.keys(this.competencies);
                const angleStep = (2 * Math.PI) / competencyKeys.length;

                let svg = `
                    <svg viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">
                        <!-- 배경 원들 -->
                        <circle cx="${center}" cy="${center}" r="${radius * 0.2}" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                        <circle cx="${center}" cy="${center}" r="${radius * 0.4}" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                        <circle cx="${center}" cy="${center}" r="${radius * 0.6}" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                        <circle cx="${center}" cy="${center}" r="${radius * 0.8}" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                        <circle cx="${center}" cy="${center}" r="${radius}" fill="none" stroke="#e2e8f0" stroke-width="2"/>
                `;

                // 축 그리기
                competencyKeys.forEach((key, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const x = center + Math.cos(angle) * radius;
                    const y = center + Math.sin(angle) * radius;
                    
                    svg += `<line x1="${center}" y1="${center}" x2="${x}" y2="${y}" stroke="#cbd5e0" stroke-width="1"/>`;
                    
                    // 라벨 추가
                    const labelX = center + Math.cos(angle) * (radius + 20);
                    const labelY = center + Math.sin(angle) * (radius + 20);
                    const competency = this.competencies[key];
                    
                    svg += `<text x="${labelX}" y="${labelY}" text-anchor="middle" dominant-baseline="middle" 
                            font-size="12" fill="#4a5568" font-weight="600">
                            ${competency.icon} ${competency.title}
                            </text>`;
                });

                // 데이터 폴리곤 그리기
                let pathData = '';
                competencyKeys.forEach((key, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const score = scores[key] || 0;
                    const distance = (score / 100) * radius;
                    const x = center + Math.cos(angle) * distance;
                    const y = center + Math.sin(angle) * distance;
                    
                    if (index === 0) {
                        pathData += `M ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                    }
                });
                pathData += ' Z';

                svg += `<path d="${pathData}" fill="rgba(102, 126, 234, 0.3)" stroke="#667eea" stroke-width="2"/>`;

                // 데이터 포인트 그리기
                competencyKeys.forEach((key, index) => {
                    const angle = index * angleStep - Math.PI / 2;
                    const score = scores[key] || 0;
                    const distance = (score / 100) * radius;
                    const x = center + Math.cos(angle) * distance;
                    const y = center + Math.sin(angle) * distance;
                    
                    svg += `<circle cx="${x}" cy="${y}" r="4" fill="#667eea" stroke="#ffffff" stroke-width="2"/>`;
                });

                svg += '</svg>';
                container.innerHTML = svg;
            }

            generateRecommendations() {
                const container = document.getElementById('recommendations');
                const recommendations = [];

                // 각 역량별 점수 계산
                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const checkedCount = competency.items.filter((item, index) => 
                        this.checkedItems[`${key}-${index}`]).length;
                    const score = (checkedCount / competency.items.length) * 100;

                    if (score < 50) {
                        recommendations.push({
                            icon: competency.icon,
                            title: `${competency.title} 역량 강화 필요`,
                            text: this.getRecommendationText(key, score)
                        });
                    } else if (score >= 80) {
                        recommendations.push({
                            icon: '🌟',
                            title: `${competency.title} 역량 우수`,
                            text: `${competency.title} 역량이 잘 발달되어 있습니다. 이 강점을 활용하여 다른 역량도 함께 발전시켜보세요.`
                        });
                    }
                });

                if (recommendations.length === 0) {
                    recommendations.push({
                        icon: '🎯',
                        title: '균형잡힌 발달',
                        text: '모든 SEL 역량이 균형있게 발달하고 있습니다. 지속적인 성장을 위해 꾸준히 노력해주세요.'
                    });
                }

                container.innerHTML = recommendations.map(rec => `
                    <div class="recommendation-card">
                        <div class="recommendation-title">
                            ${rec.icon} ${rec.title}
                        </div>
                        <div class="recommendation-text">${rec.text}</div>
                    </div>
                `).join('');
            }

            getRecommendationText(competencyKey, score) {
                const texts = {
                    selfAwareness: '자기 성찰 일기 쓰기, 감정 인식 연습, 마음챙김 명상을 통해 자기인식 능력을 향상시켜보세요.',
                    selfManagement: '목표 설정과 계획 수립, 감정 조절 기법 연습, 스트레스 관리 방법을 익혀보세요.',
                    socialAwareness: '다양한 사람들과 대화하기, 타인의 감정 관찰하기, 문화적 다양성에 대해 학습해보세요.',
                    relationshipSkills: '적극적 경청 연습, 협력 활동 참여, 갈등 해결 기법을 학습해보세요.',
                    responsibleDecision: '윤리적 딜레마 토론 참여, 의사결정 과정 체계화, 결과에 대한 책임감 기르기를 실천해보세요.'
                };
                return texts[competencyKey] || '해당 역량 향상을 위한 활동에 참여해보세요.';
            }

            bindEvents() {
                // 자동 저장 (30초마다)
                setInterval(() => {
                    this.autoSave();
                }, 30000);
            }

            autoSave() {
                HTHT.StorageManager.save('selChecklist', this.checkedItems);
            }

            saveProgress() {
                HTHT.StorageManager.save('selChecklist', this.checkedItems);
                HTHT.Toast.show('진행상황이 저장되었습니다.', 'success');
            }

            loadProgress() {
                const savedData = HTHT.StorageManager.load('selChecklist');
                if (savedData) {
                    this.checkedItems = savedData;
                    this.updateCheckboxes();
                    this.updateDashboard();
                    this.updateAnalysis();
                    HTHT.Toast.show('저장된 진행상황을 불러왔습니다.', 'success');
                } else {
                    HTHT.Toast.show('저장된 데이터가 없습니다.', 'info');
                }
            }

            loadFromStorage() {
                const savedData = HTHT.StorageManager.load('selChecklist');
                if (savedData) {
                    this.checkedItems = savedData;
                }
            }

            resetChecklist() {
                if (confirm('모든 체크 항목을 초기화하시겠습니까?')) {
                    this.checkedItems = {};
                    this.updateCheckboxes();
                    this.updateDashboard();
                    this.updateAnalysis();
                    HTHT.Toast.show('체크리스트가 초기화되었습니다.', 'info');
                }
            }

            exportReport() {
                const exportData = {
                    title: 'SEL 역량 체크리스트 리포트',
                    timestamp: new Date().toISOString(),
                    checkedItems: this.checkedItems,
                    analysis: this.generateAnalysisData()
                };

                // JSON 파일로 내보내기
                HTHT.ExportManager.downloadJSON(exportData, `SEL역량리포트_${new Date().toISOString().split('T')[0]}`);

                // 텍스트 리포트 생성
                const report = this.generateTextReport();
                HTHT.ExportManager.downloadText(report, `SEL역량분석_${new Date().toISOString().split('T')[0]}`);

                HTHT.Toast.show('리포트가 성공적으로 생성되었습니다.', 'success');
            }

            generateAnalysisData() {
                const totalItems = Object.keys(this.competencies).reduce((sum, key) => 
                    sum + this.competencies[key].items.length, 0);
                const completedItems = Object.values(this.checkedItems).filter(Boolean).length;
                
                const competencyScores = {};
                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const checkedCount = competency.items.filter((item, index) => 
                        this.checkedItems[`${key}-${index}`]).length;
                    competencyScores[key] = Math.round((checkedCount / competency.items.length) * 100);
                });

                return {
                    totalItems,
                    completedItems,
                    completionRate: Math.round((completedItems / totalItems) * 100),
                    competencyScores,
                    balanceScore: parseInt(document.getElementById('balanceScore').textContent)
                };
            }

            generateTextReport() {
                const analysis = this.generateAnalysisData();
                
                let report = `
# SEL 역량 체크리스트 리포트

생성일시: ${new Date().toLocaleString('ko-KR')}

## 전체 현황
- 총 체크 항목: ${analysis.totalItems}개
- 완료된 항목: ${analysis.completedItems}개
- 전체 완성률: ${analysis.completionRate}%
- 균형 점수: ${analysis.balanceScore}/100

## 역량별 상세 분석

`;

                Object.keys(this.competencies).forEach(key => {
                    const competency = this.competencies[key];
                    const score = analysis.competencyScores[key];
                    
                    report += `### ${competency.icon} ${competency.title} (${score}%)\n`;
                    report += `${competency.description}\n\n`;
                    
                    report += '**완료된 항목:**\n';
                    competency.items.forEach((item, index) => {
                        if (this.checkedItems[`${key}-${index}`]) {
                            report += `- ✅ ${item}\n`;
                        }
                    });
                    
                    report += '\n**미완료 항목:**\n';
                    competency.items.forEach((item, index) => {
                        if (!this.checkedItems[`${key}-${index}`]) {
                            report += `- ⭕ ${item}\n`;
                        }
                    });
                    
                    report += '\n';
                });

                report += `
## 개선 제안

${this.generateImprovementSuggestions().map(suggestion => `- ${suggestion}`).join('\n')}

---
HTHT×SEL 프로젝트 - SEL 역량 체크리스트
                `.trim();

                return report;
            }

            generateImprovementSuggestions() {
                const analysis = this.generateAnalysisData();
                const suggestions = [];

                Object.keys(analysis.competencyScores).forEach(key => {
                    const score = analysis.competencyScores[key];
                    const competency = this.competencies[key];
                    
                    if (score < 50) {
                        suggestions.push(`${competency.title} 역량 강화를 위한 집중적인 활동 필요`);
                    }
                });

                if (analysis.balanceScore < 70) {
                    suggestions.push('역량 간 균형 발전을 위한 종합적 접근 필요');
                }

                if (suggestions.length === 0) {
                    suggestions.push('현재 SEL 역량이 균형있게 발달하고 있습니다. 지속적인 성장을 위해 꾸준한 노력을 계속해주세요.');
                }

                return suggestions;
            }
        }

        // 전역 함수들
        function toggleSection(competencyKey) {
            const section = document.querySelector(`#content-${competencyKey}`).closest('.competency-section');
            const content = document.getElementById(`content-${competencyKey}`);
            
            section.classList.toggle('expanded');
            content.classList.toggle('expanded');
        }

        function toggleItem(competencyKey, itemIndex) {
            window.selChecker.toggleItem(competencyKey, itemIndex);
        }

        function resetChecklist() {
            window.selChecker.resetChecklist();
        }

        function saveProgress() {
            window.selChecker.saveProgress();
        }

        function loadProgress() {
            window.selChecker.loadProgress();
        }

        function exportReport() {
            window.selChecker.exportReport();
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            window.selChecker = new SELCompetencyChecker();
        });
    </script>
</body>
</html>

